<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"           integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='facebook.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='ajax.js') }}"></script>
  </head>


  <div class="navbar navbar-default">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">McCaffrey's Hole In The Wall Golf Society</a>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="/">Home</a></li>
          <li>
            <a href="/events_list" data-toggle="collapse" data-target=".navbar-collapse.in">Events</a>
          </li>
          <li>
            <a href="/members_list" data-toggle="collapse" data-target=".navbar-collapse.in">Players</a>
          </li>
          <li class="active">
            <a href="/poy" data-toggle="collapse" data-target=".navbar-collapse.in">Player of the year</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <body>
    <div id="loaderImage" style="width:100%; text-align:center;">
      <img src="https://d13yacurqjgara.cloudfront.net/users/82092/screenshots/1073359/spinner.gif" width="130" height="100" style="float-right:50%">
    </div>
    <div id = "poys_container"></div>

  </div>
  </body>

  <script>
  $(document).ready(function() {
    // Get the login status from facebook.
    getFacebookLoginStatus(function(response) {
      if (response.status === 'connected') {
        ajaxPOST_is_admin(response.authResponse.userID,
          function success(data) {
            if (data.isAdmin) {
              addHTMLWithAdminControls(true);
            }
            else { addHTMLWithAdminControls(false); }
          },
          function failure() { addHTMLWithAdminControls(false); });
      }
      else { addHTMLWithAdminControls(false); }
    });

    ajaxGET_get_all_poys(
      function(data) {
        var poys = data['poys'];
        sortPOYsDescendingOrder(poys);
        addPOYstoHTML(poys);
        removeLoaderImage();
      },
      function() { alert('Could not load Player of the year!'); });
  });



  function sortPOYsDescendingOrder(poys) {
    var min = 0;
    poys.sort(function(a, b) {
      return b.year - a.year;
    });
  }


  function addPOYstoHTML(poys) {
    poys.forEach(function(poy) {
      $('#poys_container').append('<div id="poy_record"></div>');

      $('#poy_record').append(
        '<h3> Player of the year ' + poy.year + '</h3>');

      var fullname = poy.firstname + ' ' + poy.lastname;
      var handicap = poy.handicap;
      $('#poy_record').append(tablebody(fullname, handicap));
    });

    function tablebody(fullname, handicap) {
      return '<div class ="table-responsive">' +
        '<table class="table" id="poy_table">' +
          '<thead>' +
            '<tr>' +
              '<th>Player</th>' +
              '<th>Handicap</th>' +
            '</tr>' +
          '</thead>' +
          '<tbody>' +
            '<tr>'+
              '<td>' + fullname + '</td>' +
              '<td>' + handicap + '</td>' +
            '</tr>' +
          '</tbody>' +
        '</table>' +
      '</div>';
    }
  }

  function addHTMLWithAdminControls(adminControls) {
    if(adminControls) {
      $('.nav').append(
        '<li>' +
          '<a href="/admin" data-toggle="collapse"' + 'data-target=".navbar-collapse.in">Administration</a>' +
        '</li>');
    }
  }


  function removeLoaderImage() {
    $('#loaderImage').remove();
  }
  </script>
</html>
