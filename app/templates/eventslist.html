<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/styles/file_input.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='ajax.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='eventHITW.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='util.js') }}"></script>
    <title>Events</title>
  </head>

  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a href="/" class="navbar-brand" href="#">McCaffrey's Hole In The Wall Golf Society</a>
      </div>
      <ul class="nav navbar-nav">
        <li><a href="/events_list/"><h4>See events</h4></a></li>
        <li><a href="/members_list/"><h4>See members</h4></a></li>
      </ul>
    </div>
  </nav>

  <body>



    <table class="table table-hover table-responsive" id="event_table">
      <thead>
        <tr>
          <th>Event Title</th>
          <th>Event Location</th>
          <th>Event Time</th>
          <th>Event Date</th>
          <th>Edit Event</th>
          <th>Remove Event</th>
          <th>See Results</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

    <!-- Add Event Modal -->
    <div class="modal fade" id="editEventModal" role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Edit Event</h4>
          </div>
          <div class="modal-body">
            <table>
              <tr>
                <td>
                  Event Title
                  <input type="text" class="form-control" id="event_title">
                </td>
              </tr>
              <tr>
                <td>
                  Event Location
                  <input type="text" class="form-control" id="event_location">
                </td>
              </tr>
              <tr>
                <td>
                  Event Time
                  <input type="text" class="form-control" id="event_time">
                </td>
              </tr>
              <tr>
                <td>
                  Event Date
                  <input type="text" class="form-control" id="event_date">
                </td>
              </tr>
            </table>
          </div>
          <div class="modal-footer">
            <input tpye="button"class="btn btn-default" value="Update"
            onclick="send_update_to_server(this)" id="update_event_button">

            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
  </body>
</html>

<script>
var currently_editing_event = false;
var events = [];
var images;


$(document).ready(function() {
  $('input[type="file"]').on('change', function(e){
    var fileName = e.target.files[0].name;
    console.log('The file "' + fileName +  '" has been selected.');
  });

  ajaxGET_get_all_events(
    function successful(data) {
      events = parse_event_from_json(data);
      events.forEach(function(event){
        add_event_to_html(event);
      });
    },
    function failure() { }
  );
});


function add_event_to_html(event) {
  event_id =       event.get_event_id()
  event_title =    event.get_event_title()
  event_location = event.get_event_location()
  event_time =     event.get_event_time()
  event_date =     event.get_event_date()

  $('#event_table > tbody').append(
    '<tr>'+
      '<td>' + event_title + '</td>' +
      '<td>' + event_location + '</td>' +
      '<td>' + event_time + '</td>' +
      '<td>' + event_date + '</td>' +
      '<td>' +
        '<button class="btn btn-default" data-toggle="modal"  data-target="#editEventModal" onClick="update_event_button_click(this);">Edit Event</button>' +
      '</td>' +
      '<td>' +
        '<button class="btn btn-default" onClick="delete_button_click(this)">Remove Event</button>' +
      '</td>' +
      '<td>' +
        '<button class="btn btn-default" onClick="show_results_for_event(this)">See Results</button>' +
      '</td>' +
    '</tr>')
}

$("#event_table tbody").on("click", "tr", function(e) {
    console.log($(e).index());
});


function get_event_for_button_index(button, events) {
  var index = $(button).closest('tr').index();
  return events[index];
}


function show_results_for_event(button) {
  // Get the event associated with the button index in the table.
  var event = get_event_for_button_index(button, events);
  window.location.replace('/results_for_event/' + event.get_event_id());
}

function update_event_button_click(button) {
  var event = get_event_for_button_index(button, events);
  fill_edit_modal(event);
}

function fill_edit_modal(event) {
  // Attach an event to the update button,
  // so that when it is clicked we know what event
  // to update.
  $('#update_event_button').data('data-event', event);
  $('#event_title').val(event.get_event_title());
  $('#event_location').val(event.get_event_location());
  $('#event_time').val(event.get_event_time());
  $('#event_date').val(event.get_event_date());
}



function send_update_to_server(button) {
  var event = $('#update_event_button').data('data-event');

  // Get the newly entered values.
  var updated_event_title = $('#event_title').val();
  var updated_event_location = $('#event_location').val();
  var updated_event_time = $('#event_time').val();
  var updated_event_date = $('#event_date').val();

  // Set the events attributes to the new attributes.
  event.set_event_title(updated_event_title);
  event.set_event_location(updated_event_location);
  event.set_event_time(updated_event_time);
  event.set_event_date(updated_event_date);

  // Send a PUT request with the updated event.
  ajaxPUT_update_event(event,
    function success(data) {
      location.reload(true);
    },
    function failure() {

    }
  );
}

function delete_button_click(button) {
  var event = get_event_for_button_index(button, events);
  remove_event(event);
}

function remove_event(event) {
  if (confirm("Are you sure you want to delete " +
  event.get_event_location() + " on " +
  event.get_event_date() + " at " +
  event.get_event_time() + "?")) {

    ajaxDELETE_delete_event(event.get_event_id(),
      function successful(data) {
        location.reload(true);
      },
      function failure() {}
    );
  }
}
</script>
